---
import type { CollectionEntry } from "astro:content";

interface Props {
  entries: CollectionEntry<"entries">[];
  tagName: string;
}

const { entries, tagName } = Astro.props;

// çµ±è¨ˆæƒ…å ±ã®è¨ˆç®—
const totalEntries = entries.length;

const thirtyDaysAgo = new Date();
thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
const recentEntries = entries.filter(
  (entry) => new Date(entry.data.date) >= thirtyDaysAgo
).length;

const sortedByDate = [...entries].sort(
  (a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime()
);
const firstAppearance = sortedByDate[0]?.data.date || "-";

// åª’ä½“åˆ¥ã®ä»¶æ•°
const sourceTypeCounts: Record<string, number> = {};
entries.forEach((entry) => {
  const type = entry.data.sourceType;
  sourceTypeCounts[type] = (sourceTypeCounts[type] || 0) + 1;
});

const sourceTypeLabels: Record<string, string> = {
  book: "æœ¬",
  article: "è¨˜äº‹",
  video: "å‹•ç”»",
  conversation: "ä¼šè©±",
  other: "ãã®ä»–",
};

const stats = [
  { label: "ç·ã‚¨ãƒ³ãƒˆãƒªæ•°", value: totalEntries, icon: "ğŸ“Š" },
  { label: "ç›´è¿‘30æ—¥", value: recentEntries, icon: "ğŸ“…" },
  { label: "æœ€åˆã®å‡ºç¾", value: firstAppearance, icon: "ğŸ¯" },
];
---

<section class="py-12 bg-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">çµ±è¨ˆæƒ…å ±</h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      {
        stats.map((stat) => (
          <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center hover-lift">
            <div class="text-3xl mb-2">{stat.icon}</div>
            <div class="text-2xl font-bold text-gray-900 mb-1">
              {stat.value}
            </div>
            <div class="text-sm text-gray-600">{stat.label}</div>
          </div>
        ))
      }
    </div>

    {
      Object.keys(sourceTypeCounts).length > 0 && (
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">åª’ä½“åˆ¥ã®åˆ†å¸ƒ</h3>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            {Object.entries(sourceTypeCounts).map(([type, count]) => (
              <div class="text-center">
                <div class="text-xl font-bold text-gray-900">{count}</div>
                <div class="text-sm text-gray-600">
                  {sourceTypeLabels[type] || type}
                </div>
              </div>
            ))}
          </div>
        </div>
      )
    }
  </div>
</section>
