---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import Layout from '../../components/Layout.astro';

export const getStaticPaths = (async () => {
  const entries = await getCollection('entries');
  return entries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content } = await entry.render();

const sourceTypeLabels: Record<string, string> = {
  book: '本',
  article: '記事',
  video: '動画',
  conversation: '会話',
  other: 'その他',
};

const impactLevelLabels: Record<string, string> = {
  small: '小',
  medium: '中',
  large: '大',
};
---

<Layout title={`${entry.data.title} | DepthForge`} description={entry.data.title}>
  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <!-- メタ情報 -->
    <div class="bg-white border border-gray-200 rounded-lg p-6 mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
        {entry.data.title}
      </h1>
      
      <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-4">
        <div class="flex items-center gap-2">
          <span class="font-medium">日付:</span>
          <span>{entry.data.date}</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="font-medium">種別:</span>
          <span class="px-2 py-1 bg-gray-100 rounded">
            {sourceTypeLabels[entry.data.sourceType]}
          </span>
        </div>
        <div class="flex items-center gap-2">
          <span class="font-medium">影響度:</span>
          <span class="px-2 py-1 bg-gray-100 rounded">
            {impactLevelLabels[entry.data.impactLevel]}
          </span>
        </div>
      </div>
      
      <div class="mb-4">
        <span class="font-medium text-sm text-gray-600">出典:</span>
        {entry.data.sourceURL ? (
          <a 
            href={entry.data.sourceURL} 
            target="_blank" 
            rel="noopener noreferrer"
            class="text-sm text-blue-600 hover:text-blue-800 ml-2"
          >
            {entry.data.sourceTitle}
          </a>
        ) : (
          <span class="text-sm text-gray-900 ml-2">{entry.data.sourceTitle}</span>
        )}
      </div>
      
      <div>
        <span class="font-medium text-sm text-gray-600 block mb-2">タグ:</span>
        <div class="flex flex-wrap gap-2">
          {entry.data.tags.map(tag => (
            <a 
              href={`/tags/${encodeURIComponent(tag)}`}
              class="text-sm px-3 py-1 bg-gray-50 text-gray-700 rounded border border-gray-200 hover:bg-gray-100 transition-colors"
            >
              {tag}
            </a>
          ))}
        </div>
      </div>
    </div>
    
    <!-- 本文 -->
    <div class="prose max-w-none bg-white border border-gray-200 rounded-lg p-8">
      <Content />
    </div>
    
    <!-- ナビゲーション -->
    <div class="mt-8 text-center">
      <a 
        href="/entries" 
        class="inline-block px-6 py-3 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors"
      >
        ← エントリ一覧に戻る
      </a>
    </div>
  </article>
</Layout>
